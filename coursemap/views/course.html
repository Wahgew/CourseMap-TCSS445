<!-- FEEL FREE TO CHANGE BOTH COURSE HTML AND ITS CONTROLLERS IT CALLS-->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/stylesheets/index.css"> 
    <title>Course Directory - CourseMap</title>
</head>
<body>
    <header>
        <a href="index.html" style="text-decoration: none; color: inherit;">
            <div class="logo">
                <img src="/assets/logo.png" alt="Logo">
                <h1>CourseMap</h1>
            </div>
        </a>
        <input type="checkbox" id="nav_check" hidden>
        <nav>
            <ul>
                <li><a href="/">Home</a></li>
                <li><a href="/professor">Professor</a></li>
                <li><a href="/course" class="active">Course</a></li>
                <li><a href="/student">Student</a></li>
                <li><a href="/assignment">Assignment</a></li>
            </ul>
        </nav>
        <label for="nav_check" class="NavLanscapeStyle">
            <div></div>
            <div></div>
            <div></div>
        </label>
    </header>

    <section class="Center-Section1">
        <img src="/assets/UWT.jpg" alt="UWT Campus">
        <div class="text-container">
            <h1>Course Directory</h1>
            <div class="search__container">
                <label for="courseDropdown">Select a Course:</label>
                <select id="courseDropdown" class="search__input">
                    <option value="">Select a course</option>
                </select>
            </div>
        </div>
    </section>

    <section class="Center-Section2">
        <div class="text-container2" id="resultSection" style="display: none;">
            <div class="course-info-card">
                <h2>Course Details</h2>
                <div id="courseInfo" class="info-grid"></div>
            </div>
            
            <div class="assignments-section">
                <h2>Course Assignments</h2>
                <div class="assignment-table">
                    <table>
                        <thead>
                            <tr>
                                <th>Assignment Type</th>
                                <th>Average Completion Time</th>
                                <th>Total Students</th>
                            </tr>
                        </thead>
                        <tbody id="assignmentTableBody"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </section>

    <footer>
        <div class="container">
            <a href="/">
                <img src="/assets/logo.png" alt="CourseMap Logo">
            </a>
            <p>Â© 2024 CourseMap, LLC. All Rights Reserved.</p>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            const courseDropdown = document.getElementById('courseDropdown');
            const resultSection = document.getElementById('resultSection');
            const courseInfo = document.getElementById('courseInfo');
            const assignmentTableBody = document.getElementById('assignmentTableBody');

            // Load all courses
            try {
                const response = await fetch('/api/courses');
                const courses = await response.json();
                courses.forEach(course => {
                    const option = document.createElement('option');
                    option.value = course.CourseID;
                    option.textContent = `${course.CourseName} - ${course.ProfessorName}`;
                    courseDropdown.appendChild(option);
                });
            } catch (error) {
                console.error('Error fetching courses:', error);
            }

            // Handle course selection
            courseDropdown.addEventListener('change', async (event) => {
                const courseId = event.target.value;
                if (!courseId) {
                    resultSection.style.display = 'none';
                    return;
                }

                try {
                    const response = await fetch(`/api/courses/details?courseId=${courseId}`);
                    const data = await response.json();
                    
                    if (data.length > 0) {
                        const course = data[0];
                        resultSection.style.display = 'block';
                        
                        // Display course info
                        courseInfo.innerHTML = `
                            <div class="info-row">
                                <span class="info-label">Course Name:</span>
                                <span class="info-value">${course.CourseName}</span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">Professor:</span>
                                <span class="info-value">${course.ProfessorName}</span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">Course ID:</span>
                                <span class="info-value">${course.CourseID}</span>
                            </div>
                        `;

                        // Clear and populate assignment table
                        assignmentTableBody.innerHTML = '';
                        data.forEach(assignment => {
                            if (assignment.AssignID) {
                                assignmentTableBody.innerHTML += `
                                    <tr>
                                        <td>${assignment.AssignmentType}</td>
                                        <td>${assignment.StuAvgTime.toFixed(2)} hours</td>
                                        <td>${assignment.TotalStudents || 0}</td>
                                    </tr>
                                `;
                            }
                        });

                        if (data.every(item => !item.AssignID)) {
                            assignmentTableBody.innerHTML = '<tr><td colspan="3">No assignments found for this course.</td></tr>';
                        }
                    }
                } catch (error) {
                    console.error('Error fetching course details:', error);
                }
            });
        });
    </script>
    
    <!--THIS CAN BE PLACED IN THE STYLESHEETS-->
    <style>
        /* Additional styles for better formatting */   
        .course-info-card {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }

        .course-info-card h2 {
            margin-bottom: 20px;
            color: var(--primary-color);
            text-align: left;
        }

        .info-grid {
            display: grid;
            gap: 15px;
        }

        .info-row {
            display: grid;
            grid-template-columns: 150px 1fr;
            gap: 20px;
            padding: 10px;
            border-bottom: 1px solid #eee;
        }

        .info-label {
            font-weight: bold;
            color: #666;
        }

        .assignments-section {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .assignments-section h2 {
            margin-bottom: 20px;
            color: var(--primary-color);
            text-align: left;
        }

        .assignment-table table {
            width: 100%;
            border-collapse: collapse;
        }

        .assignment-table th,
        .assignment-table td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        .assignment-table th {
            background: #f5f5f5;
            font-weight: 600;
        }

        .assignment-table tr:hover {
            background: #f9f9f9;
        }

        .search__container {
            display: flex;
            flex-direction: column;
            gap: 10px;
            align-items: center;
        }

        .search__container label {
            color: white;
            font-size: 1.2rem;
            font-weight: 500;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
        }
    </style>
</body>
</html>
