<!-- FEEL FREE TO CHANGE BOTH ASSIGNMENT HTML AND ITS CONTROLLERS IT CALLS-->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Assignment - CourseMap</title>
    <link rel="stylesheet" href="/stylesheets/index.css">
</head>
<body>
    <header>
        <a href="index.html" style="text-decoration: none; color: inherit;">
            <div class="logo">
                <img src="/assets/logo.png" alt="Logo">
                <h1>CourseMap</h1>
            </div>
        </a>
        <input type="checkbox" id="nav_check" hidden>
        <nav>
            <ul>
                <li><a href="/">Home</a></li>
                <li><a href="/professor">Professor</a></li>
                <li><a href="/course">Course</a></li>
                <li><a href="/student">Student</a></li>
                <li><a href="/assignment" class="active">Assignment</a></li>
            </ul>
        </nav>
        <!-- Menu for navigation bars -->
        <label for="nav_check" class="NavLanscapeStyle">
            <div></div>
            <div></div>
            <div></div>
        </label>
    </header>

    <section class="section Center-Section1">
        <img src="/assets/UWT.jpg" alt="UWT Campus">
        <div class="text-container">
            <h1>Assignment Details</h1>
            <div class="search__container">
                <select class="search__input" id="assignmentSelect">
                    <option value="">Select an assignment</option>
                </select>
            </div>
        </div>
    </section>

    <section class="section Center-Section2">
        <div class="text-container2">
            <div id="resultSection" style="display: none;">
                <h1>Student Completion Times</h1>
                <div class="assignment-history">
                    <table>
                        <thead>
                            <tr>
                                <th>Student Name</th>
                                <th>Time Spent (hours)</th>
                                <th>Compared to Average</th>
                            </tr>
                        </thead>
                        <tbody id="assignmentResults">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </section>

    <footer>
        <div class="container">
            <a href="/"><img src="/assets/logo.png" alt="CourseMap Logo"></a>
            <p>Â© 2024 CourseMap, LLC. All Rights Reserved.</p>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Load assignments
            fetch('/api/assignments')
                .then(response => response.json())
                .then(assignments => {
                    const select = document.getElementById('assignmentSelect');
                    assignments.forEach(assign => {
                        const option = document.createElement('option');
                        option.value = assign.AssignID;
                        option.textContent = `${assign.AssignmentType} - ${assign.CourseName}`;
                        select.appendChild(option);
                    });
                })
                .catch(error => console.error('Error loading assignments:', error));

            // Handle assignment selection
            document.getElementById('assignmentSelect').addEventListener('change', function() {
                const assignId = this.value;
                const resultSection = document.getElementById('resultSection');
                
                if (!assignId) {
                    resultSection.style.display = 'none';
                    return;
                }

                fetch(`/api/assignments/details?assignId=${assignId}`)
                    .then(response => response.json())
                    .then(details => {
                        resultSection.style.display = 'block';
                        const tbody = document.getElementById('assignmentResults');
                        const avgTime = details[0]?.StuAvgTime || 0;
                        
                        tbody.innerHTML = details.map(record => {
                            if (!record.StudentName) return '';
                            const timeSpent = record.TimeInput || 0;
                            const difference = ((timeSpent - avgTime) / avgTime * 100).toFixed(1);
                            const differenceClass = difference > 0 ? 'above-average' : 'below-average';
                            
                            return `
                                <tr>
                                    <td>${record.StudentName}</td>
                                    <td>${timeSpent.toFixed(2)}</td>
                                    <td class="${differenceClass}">${difference}%</td>
                                </tr>
                            `;
                        }).join('');
                    })
                    .catch(error => console.error('Error loading assignment details:', error));
            });
        });
    </script>
</body>
</html>
