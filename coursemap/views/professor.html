<!-- FEEL FREE TO CHANGE BOTH PROFESSOR HTML AND ITS CONTROLLERS IT CALLS-->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/stylesheets/index.css">
    <title>Professor Details - CourseMap</title>
</head>
<body>
    <header>
        <div class="logo">
            <a href="/">
                <img src="/assets/logo.png" alt="CourseMap Logo">
            </a>
            <h1>CourseMap</h1>
        </div>
        <input type="checkbox" id="nav_check" hidden>
        <nav>
            <ul>
                <li><a href="/">Home</a></li>
                <li><a href="/professor" class="active">Professor</a></li>
                <li><a href="/course">Course</a></li>
                <li><a href="/student">Student</a></li>
                <li><a href="/assignment">Assignment</a></li>
            </ul>
        </nav>
        <label for="nav_check" class="NavLanscapeStyle">
            <div></div>
            <div></div>
            <div></div>
        </label>
    </header>

    <section class="Center-Section1">
        <img src="/assets/UWT.jpg" alt="UWT Campus">
        <div class="text-container">
            <h1>Professor Directory</h1>
            <div class="search__container">
                <input type="text" id="professorSearch" class="search__input" placeholder="Search by professor name">
            </div>
            <div class="dropdown-container">
                <select id="professorDropdown" class="search__input" style="margin-top: 20px;">
                    <option value="">Select a professor</option>
                </select>
            </div>
        </div>
    </section>

    <section class="Center-Section2">
        <div class="text-container2" id="resultSection" style="display: none;">
            <h1>Professor Information</h1>
            <div class="professor-info-card">
                <div id="professorInfo"></div>
            </div>
            
            <div class="courses-table">
                <h2>Courses and Statistics</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Course Name</th>
                            <th>Number of Assignments</th>
                            <th>Average Completion Time</th>
                            <th>Total Students</th>
                        </tr>
                    </thead>
                    <tbody id="coursesTableBody"></tbody>
                </table>
            </div>
        </div>
    </section>

    <footer>
        <div class="container">
            <a href="/">
                <img src="/assets/logo.png" alt="CourseMap Logo">
            </a>
            <p>Â© 2024 CourseMap, LLC. All Rights Reserved.</p>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            const professorSearch = document.getElementById('professorSearch');
            const professorDropdown = document.getElementById('professorDropdown');
            const resultSection = document.getElementById('resultSection');
            const professorInfo = document.getElementById('professorInfo');
            const coursesTableBody = document.getElementById('coursesTableBody');

            // Load all professors
            try {
                const response = await fetch('/api/professors');
                const professors = await response.json();
                professors.forEach(prof => {
                    const option = document.createElement('option');
                    option.value = prof.ProfEmail;
                    option.textContent = `${prof.LName}, ${prof.FName} (${prof.CourseCount} courses)`;
                    professorDropdown.appendChild(option);
                });
            } catch (error) {
                console.error('Error fetching professors:', error);
            }

            // Handle professor search
            professorSearch.addEventListener('input', (e) => {
                const searchTerm = e.target.value.toLowerCase();
                const options = professorDropdown.options;
                
                for (let option of options) {
                    const text = option.text.toLowerCase();
                    if (text.includes(searchTerm)) {
                        option.style.display = '';
                    } else {
                        option.style.display = 'none';
                    }
                }
            });

            // Handle professor selection
            professorDropdown.addEventListener('change', async (event) => {
                const email = event.target.value;
                if (!email) {
                    resultSection.style.display = 'none';
                    return;
                }

                try {
                    const response = await fetch(`/api/professors/details?email=${email}`);
                    const data = await response.json();
                    
                    // Update this part in the professor.html file
                    if (data.length > 0) {
                        resultSection.style.display = 'block';
                        const professor = data[0];

                        // Display professor info
                        professorInfo.innerHTML = `
                            <p><strong>Name:</strong> ${professor.FName} ${professor.LName}</p>
                            <p><strong>Email:</strong> ${professor.ProfEmail}</p>
                            <p><strong>Total Courses:</strong> ${data.filter(course => course.CourseID).length}</p>
                        `;

                        // Clear and populate courses table
                        coursesTableBody.innerHTML = '';
                        data.forEach(course => {
                            if (course.CourseID) {
                                coursesTableBody.innerHTML += `
                                    <tr>
                                        <td>${course.CourseName}</td>
                                        <td>${course.AssignmentCount || 0}</td>
                                        <td>${course.AvgCompletionTime ? course.AvgCompletionTime + ' hours' : 'N/A'}</td>
                                        <td>${course.TotalStudents || 0}</td>
                                    </tr>
                                `;
                            }
                        });

                        if (data.every(item => !item.CourseID)) {
                            coursesTableBody.innerHTML = '<tr><td colspan="4" class="no-courses">No courses found for this professor.</td></tr>';
                        }
                    }
             } catch (error) {
                    console.error('Error fetching professor details:', error);
                }
            });
        });
    </script>
    <!-- EITHER ADD SCRIPTS TO THE MAIN.JS OR DIRECTLY PUT THE SCRIPTS INTO THE HTML FILE // backend is not working propertly-->
</body>
</html>